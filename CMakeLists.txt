cmake_minimum_required(VERSION 3.14 FATAL_ERROR)

find_package(Git REQUIRED QUIET)

if(GIT_EXECUTABLE)
    execute_process(
            COMMAND ${GIT_EXECUTABLE} tag --points-at HEAD
            WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
            OUTPUT_VARIABLE GIT_DESCRIBE_VERSION
            RESULT_VARIABLE GIT_DESCRIBE_ERROR_CODE
            OUTPUT_STRIP_TRAILING_WHITESPACE
    )
    if(NOT GIT_DESCRIBE_ERROR_CODE)
        string(SUBSTRING ${GIT_DESCRIBE_VERSION} 1 -1 GIT_DESCRIBE_VERSION)
    endif()
endif()

project(CPM VERSION "${GIT_DESCRIBE_VERSION}" LANGUAGES NONE)

include("${CMAKE_CURRENT_SOURCE_DIR}/cmake/CPM.cmake")
